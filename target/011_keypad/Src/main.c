/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2022 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */


#include <stdint.h>
#include <stdio.h>


void delay(void){

	for(uint32_t i=0; i<300000; i++);

}



int main(void)
{
	// peripheral address
	/*uint32_t volatile *const pClockControlRegister = (uint32_t*) (0x40020C00+0x30);
	uint32_t volatile *const pGPIODModeRegister = (uint32_t*) (0x40020C00+0x00);
	uint32_t volatile *const pGPIODOutputRegister = (uint32_t*) (0x40020C00+0x14);
	uint32_t volatile *const pGPIODInputRegister = (uint32_t*) (0x40020C00+0x10);
	uint32_t volatile *const pGPIODPullUpDownRegister = (uint32_t*) (0x40020C00+0x0C);*/

	uint32_t volatile *const pGPIODModeRegister = (uint32_t*)(0x40020C00);
	uint32_t volatile *const pGPIODInputRegister = (uint32_t*) (0x40020C00 + 0x10);
	uint32_t volatile *const pGPIODOutputRegister = (uint32_t*) (0x40020C00 + 0x14);
	uint32_t volatile *const pClockControlRegister = (uint32_t*)(0x40023800 + 0x30);
	uint32_t volatile *const pGPIODPullUpDownRegister = (uint32_t*) (0x40020C00 + 0x0C);
	// GPIOD clocuku aktiflestir

	*pClockControlRegister |= (1<<3);

	// PD0 PD1 PD2 PD3 output (rows)
	*pGPIODModeRegister &= ~(0xFF); // clear
	*pGPIODModeRegister |= 0x55; //set

	// PD8 PD9 PD10 PD11 input (columns)

	*pGPIODModeRegister &= ~(0xFF<<16); // clear

	// PD8 PD9 PD10 PD11 enable pull up resistor
	*pGPIODPullUpDownRegister &= ~(0xFF<<16);
	*pGPIODPullUpDownRegister |= (0x55<<16);

	while(1){
	// make all rows  HIGH
	*pGPIODOutputRegister |= 0x0F;

	// make R1 LOW (pd0)
	*pGPIODOutputRegister &= ~(1<<0);

	if(!(*pGPIODInputRegister & (1<<8))){
		// press
		delay();
		printf("1\n");
	}

	//check c2(p09)
	if(!(*pGPIODInputRegister & (1<<9))){
		delay();
			// press
			printf("2\n");
	}
	if(!(*pGPIODInputRegister & (1<<10))){
			// press
			delay();
			printf("3\n");
	}

	if(!(*pGPIODInputRegister & (1<<11))){
			// press
			delay();
			printf("A\n");
		}
//
	*pGPIODOutputRegister |= 0x0F;
	// make R2 LOW (pd1)
	*pGPIODOutputRegister &= ~(1<<1);
	if(!(*pGPIODInputRegister & (1<<8))){
		// press
		delay();
		printf("4\n");
	}

	//check c2(p09)
	if(!(*pGPIODInputRegister & (1<<9))){
		delay();
			// press
			printf("5\n");
	}
	if(!(*pGPIODInputRegister & (1<<10))){
			// press
			delay();
			printf("6\n");
	}

	if(!(*pGPIODInputRegister & (1<<11))){
			// press
			delay();
			printf("B\n");
		}

	*pGPIODOutputRegister |= 0x0F;
	// make R2 LOW (pd0)
	*pGPIODOutputRegister &= ~(1<<1);

//
	*pGPIODOutputRegister |= 0x0F;
	// make R3 LOW (pd2)
	*pGPIODOutputRegister &= ~(1<<2);
		if(!(*pGPIODInputRegister & (1<<8))){
			// press
			delay();
			printf("7\n");
		}

		//check c2(p09)
		if(!(*pGPIODInputRegister & (1<<9))){
			delay();
				// press
				printf("8\n");
		}
		if(!(*pGPIODInputRegister & (1<<10))){
				// press
				delay();
				printf("9\n");
		}

		if(!(*pGPIODInputRegister & (1<<11))){
				// press
				delay();
				printf("C\n");
			}

//

		*pGPIODOutputRegister |= 0x0F;
			// make R4 LOW (pd1)
			*pGPIODOutputRegister &= ~(1<<3);
			if(!(*pGPIODInputRegister & (1<<8))){
				// press
				delay();
				printf("*\n");
			}

			//check c2(p09)
			if(!(*pGPIODInputRegister & (1<<9))){
					delay();
					// press
					printf("0\n");
			}
			if(!(*pGPIODInputRegister & (1<<10))){
					// press
					delay();
					printf("#\n");
			}

			if(!(*pGPIODInputRegister & (1<<11))){
					// press
					delay();
					printf("D\n");
				}
		}

}




